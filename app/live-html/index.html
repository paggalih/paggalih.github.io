<!DOCTYPE html>
<html lang="id-ID">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Live HTML Editor</title>
    <meta content="HTML editor dengan panel yang bisa di-resize, multi-tab, dan zoom font" name="description">
    <meta name="author" content="Galih Pradananta & Gemini">
    <link href="/assets/img/letter-g.gif" rel="icon">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/monokai.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/dialog/dialog.min.css">

    <style>
        :root { --primary-color: #4CAF50; --primary-dark: #45a049; }
        body { font-family: 'Segoe UI', sans-serif; background: #f5f7fa; padding: 0 0; margin: 0; }
        .container { max-width: 1600px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); border-radius: 12px; overflow: hidden; background-color: white; transition: all 0.3s ease; }
        header { background: linear-gradient(to right, var(--primary-color), #2E8B57); color: white; padding: 20px; text-align: center; position: relative; }
        .controls { margin-top: 10px; background-color: #f9f9f9; border-bottom: 1px solid #eee; display: flex; justify-content: center; align-items: center; gap: 10px; flex-wrap: wrap; }
        .btn { background-color: var(--primary-color); }
        .btn:hover { background-color: var(--primary-dark); }
        .editor-container { display: flex; flex-direction: row; height: 90vh; }
        .code-panel, .preview-panel { height: 100%; }
        .panel-header { padding: 10px 15px; font-weight: 600; background: #f1f1f1; border-bottom: 1px solid #ddd; }
        
        .code-panel .panel-header { background-color: #333; color: white; border-bottom: 1px solid #555; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; }
        .tab-bar { display: flex; align-items: center; height: 100%; overflow-x: auto; }
        .tab-item { background-color: #272822; color: #aaa; padding: 10px 15px; cursor: pointer; border-right: 1px solid #333; white-space: nowrap; }
        .tab-item.active { background-color: #49483e; color: white; }
        .close-tab { margin-left: 10px; font-weight: bold; cursor: pointer; }
        .close-tab:hover { color: #f92672; }
        #add-tab-btn { background: none; border: 1px solid #555; color: white; font-size: 1.2em; cursor: pointer; padding: 0 10px; margin-left: 5px; border-radius: 4px;}
        #add-tab-btn:hover { background-color: #555; }
        
        .CodeMirror { flex-grow: 1; height: auto; font-size: 14px; } /* Atur font-size default */
        #preview { width: 100%; height: 100%; border: 1px solid #ccc; border-radius: 4px; background-color: white; }
        .gutter { background-color: #eee; background-repeat: no-repeat; background-position: 50%; }
        .gutter.gutter-horizontal { background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxl7ACYGEQ2oAB40gUoAokYTBgYAY1gEGLpQyG4AAAAASUVORK5CYII='); cursor: col-resize; }
        .fullscreen-btn { position: absolute; top: 15px; right: 15px; }
        .escape-btn { display: none; position: absolute; top: 15px; right: 15px; z-index: 1002; }
        body.fullscreen-active { padding: 0; overflow: hidden; }
        body.fullscreen-active .container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; max-width: 100%; border-radius: 0; z-index: 1000; }
        body.fullscreen-active header, body.fullscreen-active .controls { display: none; }
        body.fullscreen-active .editor-container { height: 100vh; }
        body.fullscreen-active .escape-btn { display: block; }
        .CodeMirror-dialog { background: #333; color: white; }
        .CodeMirror-dialog input { background: #555; color: white; border: 1px solid #777; }
        header {display:none;}
    </style>
</head>
<body>
    <div class="container" id="main-container">
        <header>
            <h1>Live HTML Editor Galih Pradananta</h1>
            <p class="description">Gunakan <b>Ctrl+S</b> atau <b>Ctrl+Enter</b> untuk menjalankan kode.</p>
            <button id="fullscreen-btn" class="btn btn-sm btn-outline-light text-white fullscreen-btn"><i class="bi bi-arrows-fullscreen"></i> Fullscreen</button>
        </header>

        <div class="controls">
            <button id="refresh-btn" class="btn btn-success text-white"><i class="bi bi-play-fill"></i> <span>Run</span></button>
            <button id="clear-btn" class="btn btn-danger text-white"><i class="bi bi-trash"></i> Bersihkan</button>
            <button id="edit-toggle-btn" class="btn btn-warning text-white"><i class="bi bi-pencil-square"></i> <span id="edit-status-text">Edit Preview</span></button>
            <button id="inspect-btn" class="btn btn-primary text-white"><i class="bi bi-cursor-fill"></i> <span>Inspect</span></button>
            <button id="find-btn" class="btn btn-info text-white"><i class="bi bi-search"></i> <span>Find</span></button>
            <button id="format-btn" class="btn btn-secondary text-white"><i class="bi bi-wrench"></i> Format</button>
            <button id="example-btn" class="btn text-white" style="background-color: #6f42c1;"><i class="bi bi-file-code"></i> Contoh</button>
            
            <div class="ms-auto d-flex align-items-center">
                <span class="me-2 text-muted">Font Size:</span>
                <button id="zoom-out-btn" class="btn btn-light btn-sm" title="Perkecil Font"><i class="bi bi-zoom-out"></i></button>
                <button id="zoom-in-btn" class="btn btn-light btn-sm ms-1" title="Perbesar Font"><i class="bi bi-zoom-in"></i></button>
            </div>
            </div>

        <div class="editor-container">
            <div id="code-panel" class="code-panel d-flex flex-column">
                <div class="panel-header">
                    <div id="tab-bar" class="tab-bar"></div>
                    <button id="add-tab-btn" title="Tambah File Baru">+</button>
                </div>
                <textarea id="html-code"></textarea>
            </div>
            <div id="preview-panel" class="preview-panel p-3">
                <div class="panel-header mb-2"><i class="bi bi-eye"></i> Preview</div>
                <iframe id="preview"></iframe>
                <button id="escape-btn" class="btn btn-danger btn-sm escape-btn"><i class="bi bi-fullscreen-exit"></i> Keluar</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closetag.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/dialog/dialog.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/searchcursor.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/search.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-html.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.6.0/split.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const editor = CodeMirror.fromTextArea(document.getElementById('html-code'), {
                mode: 'htmlmixed', theme: 'monokai', lineNumbers: true, lineWrapping: true,
                autoCloseTags: { whenClosing: true, whenOpening: true, indentTags: [] },
                indentWithTabs: false, indentUnit: 2,
                extraKeys: {
                    "Ctrl-S": function(instance) { updatePreview(); return false; },
                    "Ctrl-Enter": function(instance) { updatePreview(); return false; }
                }
            });

            Split(['#code-panel', '#preview-panel'], {
                sizes: [50, 50], minSize: 200, gutterSize: 8,
                onDrag: () => editor.refresh()
            });
            
            // --- Logika Manajemen Tab (Sama seperti sebelumnya) ---
            const tabBar = document.getElementById('tab-bar');
            const addTabBtn = document.getElementById('add-tab-btn');
            let tabs = [];
            let activeTabId = null;
            let nextTabId = 1;

            const exampleHTML = `<!DOCTYPE html>
<html>
<head>
    <title>Contoh Halaman</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding-top: 50px; }
        h1 { color: #4CAF50; }
    </style>
</head>
<body>
    <h1>Selamat Datang!</h1>
    <p>Ini adalah konten dari Tab 1.</p>
    <p>Anda bisa mengubah ukuran font editor dengan tombol <b>Zoom</b>.</p>
</body>
</html>`;
            
            function renderTabs() { /* ... (fungsi renderTabs tidak berubah) ... */ 
                tabBar.innerHTML = '';
                tabs.forEach(tab => {
                    const tabElement = document.createElement('div');
                    tabElement.className = 'tab-item' + (tab.id === activeTabId ? ' active' : '');
                    tabElement.dataset.tabId = tab.id;
                    tabElement.textContent = tab.name;
                    const closeBtn = document.createElement('span');
                    closeBtn.className = 'close-tab';
                    closeBtn.innerHTML = '&times;';
                    closeBtn.title = 'Tutup file';
                    closeBtn.onclick = (e) => { e.stopPropagation(); closeTab(tab.id); };
                    tabElement.appendChild(closeBtn);
                    tabElement.onclick = () => switchTab(tab.id);
                    tabBar.appendChild(tabElement);
                });
            }
            function switchTab(tabId) { /* ... (fungsi switchTab tidak berubah) ... */ 
                if (activeTabId === tabId) return;
                const oldTab = tabs.find(t => t.id === activeTabId);
                if (oldTab) { oldTab.content = editor.getValue(); }
                activeTabId = tabId;
                const newTab = tabs.find(t => t.id === activeTabId);
                editor.setValue(newTab.content);
                editor.focus();
                renderTabs();
                updatePreview();
            }
            function addTab(name = `untitled-${nextTabId}.html`, content = `<h1>Konten Baru</h1>`) { /* ... (fungsi addTab tidak berubah) ... */
                const newTab = { id: nextTabId++, name, content };
                tabs.push(newTab);
                switchTab(newTab.id);
            }
            function closeTab(tabId) { /* ... (fungsi closeTab tidak berubah) ... */
                const tabIndex = tabs.findIndex(t => t.id === tabId);
                if (tabIndex === -1) return;
                tabs.splice(tabIndex, 1);
                if (activeTabId === tabId) {
                    if (tabs.length > 0) {
                        const newActiveIndex = Math.max(0, tabIndex - 1);
                        switchTab(tabs[newActiveIndex].id);
                    } else {
                        activeTabId = null;
                        editor.setValue('');
                        addTab('untitled-1.html', '');
                    }
                }
                renderTabs();
            }
            addTabBtn.addEventListener('click', () => addTab());

            // --- PERUBAHAN JAVASCRIPT: LOGIKA UNTUK ZOOM FONT ---
            const zoomInBtn = document.getElementById('zoom-in-btn');
            const zoomOutBtn = document.getElementById('zoom-out-btn');
            const editorWrapper = editor.getWrapperElement();
            let currentFontSize = 14; // Ukuran font awal (dalam pixel)

            function applyFontSize() {
                editorWrapper.style.fontSize = currentFontSize + 'px';
                editor.refresh(); // Penting: Refresh CodeMirror agar layout-nya menyesuaikan
            }

            zoomInBtn.addEventListener('click', () => {
                currentFontSize += 1;
                applyFontSize();
            });

            zoomOutBtn.addEventListener('click', () => {
                // Beri batas minimal agar font tidak terlalu kecil
                if (currentFontSize > 8) {
                    currentFontSize -= 1;
                    applyFontSize();
                }
            });

            // Terapkan ukuran font awal saat halaman dimuat
            applyFontSize();
            // --- AKHIR PERUBAHAN JAVASCRIPT ---

            // Sisa kode JavaScript (tidak berubah)
            const preview = document.getElementById('preview');
            const refreshBtn = document.getElementById('refresh-btn');
            // ... (deklarasi variabel lainnya)
            const findBtn = document.getElementById('find-btn'), inspectBtn = document.getElementById('inspect-btn'), clearBtn = document.getElementById('clear-btn'), formatBtn = document.getElementById('format-btn'), exampleBtn = document.getElementById('example-btn'), editToggleBtn = document.getElementById('edit-toggle-btn'), editStatusText = document.getElementById('edit-status-text'), fullscreenBtn = document.getElementById('fullscreen-btn'), escapeBtn = document.getElementById('escape-btn');
            let isEditingPreview = false, isInspecting = false, debounceTimer;

// VERSI BARU DAN LEBIH BAIK
function updatePreview() {
    const activeTab = tabs.find(t => t.id === activeTabId);
    if (!activeTab) return;

    // Simpan konten terbaru dari editor ke tab aktif
    activeTab.content = editor.getValue();
    let sourceCode = activeTab.content;

    // (Logika instrumentasi untuk inspect elemen tidak berubah)
    const lines = sourceCode.split('\n');
    const instrumentedLines = lines.map((line, index) => line.replace(/<([a-zA-Z0-9]+)([^>]*?)>/g, (match, tagName, attributes) => {
        if (attributes.includes('data-source-line')) return match;
        return `<${tagName} data-source-line="${index + 1}"${attributes}>`;
    }));
    const instrumentedCode = instrumentedLines.join('\n');

    // === INILAH PERUBAHAN UTAMANYA ===
    // Gunakan srcdoc untuk memuat ulang iframe dengan lingkungan yang bersih
    preview.srcdoc = instrumentedCode;
    // ===================================

    // Karena iframe akan dimuat ulang, kita perlu menunggu sebentar
    // sebelum mengaktifkan kembali fitur inspect dan edit preview.
    preview.onload = () => {
        const previewDoc = preview.contentDocument || preview.contentWindow.document;
        if (isEditingPreview) enablePreviewEditing();
        if (isInspecting) {
            previewDoc.body.addEventListener('click', handlePreviewClick);
            previewDoc.body.style.cursor = 'pointer';
        }
    };
}
            refreshBtn.addEventListener('click', updatePreview);
            
            let scrollSyncTimer;
            editor.on('cursorActivity', (instance) => { /* ... (fungsi scrollSync tidak berubah) ... */
                clearTimeout(scrollSyncTimer);
                scrollSyncTimer = setTimeout(() => {
                    const line = instance.getCursor().line + 1;
                    const previewDoc = preview.contentDocument;
                    if (previewDoc) {
                        const targetElement = previewDoc.querySelector(`[data-source-line="${line}"]`);
                        if (targetElement) { targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
                    }
                }, 200);
            });

            formatBtn.addEventListener('click', () => { editor.setValue(html_beautify(editor.getValue(), { indent_size: 2, indent_char: ' ', max_preserve_newlines: 1 })); });
            findBtn.addEventListener('click', () => { editor.execCommand("find"); });

            const handlePreviewClick = (event) => { /* ... (fungsi handlePreviewClick tidak berubah) ... */
                event.preventDefault();
                const target = event.target;
                const sourceElement = target.closest('[data-source-line]');
                if (sourceElement) {
                    const line = parseInt(sourceElement.getAttribute('data-source-line'), 10);
                    if (!isNaN(line)) {
                        editor.setCursor({ line: line - 1, ch: 0 });
                        editor.scrollIntoView({ line: line - 1, ch: 0 }, 50);
                        editor.focus();
                    }
                }
            };
            inspectBtn.addEventListener('click', () => { /* ... (fungsi inspect tidak berubah) ... */
                isInspecting = !isInspecting;
                const previewBody = preview.contentDocument.body;
                if (isInspecting) {
                    inspectBtn.classList.replace('btn-primary', 'btn-success');
                    inspectBtn.querySelector('span').textContent = 'Inspecting...';
                    previewBody.addEventListener('click', handlePreviewClick);
                    previewBody.style.cursor = 'pointer';
                } else {
                    inspectBtn.classList.replace('btn-success', 'btn-primary');
                    inspectBtn.querySelector('span').textContent = 'Inspect';
                    previewBody.removeEventListener('click', handlePreviewClick);
                    previewBody.style.cursor = 'default';
                }
            });

            const syncPreviewToEditor = () => { /* ... (fungsi syncPreviewToEditor tidak berubah) ... */
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    const previewHTML = preview.contentDocument.body.innerHTML;
                    const cursorPos = editor.getCursor(); editor.setValue(previewHTML); editor.setCursor(cursorPos);
                    updatePreview();
                }, 300);
            };
            const enablePreviewEditing = () => { preview.contentDocument.body.contentEditable = 'true'; preview.contentDocument.body.addEventListener('input', syncPreviewToEditor); };
            const disablePreviewEditing = () => { preview.contentDocument.body.contentEditable = 'false'; preview.contentDocument.body.removeEventListener('input', syncPreviewToEditor); };
            editToggleBtn.addEventListener('click', () => { /* ... (fungsi editToggle tidak berubah) ... */
                isEditingPreview = !isEditingPreview;
                if (isEditingPreview) { enablePreviewEditing(); editStatusText.textContent = 'Nonaktifkan Edit'; editToggleBtn.classList.replace('btn-warning', 'btn-success'); } 
                else { disablePreviewEditing(); editStatusText.textContent = 'Edit Preview'; editToggleBtn.classList.replace('btn-success', 'btn-warning'); }
            });

            function toggleFullscreen() { document.body.classList.toggle('fullscreen-active'); editor.refresh(); }
            fullscreenBtn.addEventListener('click', toggleFullscreen);
            escapeBtn.addEventListener('click', toggleFullscreen);
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && document.body.classList.contains('fullscreen-active')) toggleFullscreen(); });
            
            clearBtn.addEventListener('click', () => { if (confirm('Yakin membersihkan file ini?')) editor.setValue(''); updatePreview(); });
            exampleBtn.addEventListener('click', () => { editor.setValue(exampleHTML); updatePreview(); });
            
            addTab('index.html', exampleHTML);
        });
    </script>
</body>
</html>
